@(maxPlayers: Int)

<div class="row" ng-controller="GameSearchController" ng-init="contestSearch(searchOptions)">
    <div ng-hide="isSplitScreen()" style="margin-bottom: 20px">
        <!-- Game Filtering Options -->
        <div class="col-md-6" ng-include src="'/assets/views/play/game_filters.htm'"></div>

        <!-- My Games -->
        <div class="col-md-6 contest_colors" style="padding-bottom: 4px" ng-include src="'/assets/views/play/my_contests.htm'"></div>
    </div>

    <!-- Search Results -->
    <div ng-class="{'col-md-4':(isSplitScreen()), 'col-md-12':(!isSplitScreen())}">
        <fieldset class="contest">
            <legend class="contest">
                Search Results ({{ getSearchResults(searchTerm).length || 0 }})
            </legend>
            <div class="row">
                <input class="symbol_input_text_field"
                        ng-class="{'col-md-11':(isSplitScreen()), 'col-md-4':(!isSplitScreen())}"
                        style="border-radius: 4px 4px 4px 4px"
                        type="text"
                        ng-model="searchTerm"
                        placeholder="&#xf002; Filter by Game Title">
            </div>
            <div class="availGamesContainer">
                <div class="row">
                    <div class="col-md-4 header left padding-left-16">Game Title</div>
                    <div ng-hide="isSplitScreen()" class="col-md-2 header center">Started</div>
                    <div ng-hide="isSplitScreen()" class="col-md-2 header center">Expires</div>
                    <div ng-hide="isSplitScreen()" class="col-md-2 header center">Players</div>
                    <div ng-hide="isSplitScreen()" class="col-md-2 header right">Game Features</div>
                </div>

                <div ng-repeat="c in getSearchResults(searchTerm)" class="row clickable"
                    ng-click="selectContest(c)"
                    ng-class="selectedContest.OID() === c.OID() ? 'selected' : ''">
                    <div ng-class="{'col-md-4':(!isSplitScreen()), 'col-md-12':(isSplitScreen())}">
                        <img ng-hide="c.status === 'ACTIVE'" src="/assets/images/status/offlight.png">
                        <avatar id="{{ c.participants[0].facebookID }}" style="width: 20px; height: 20px" />
                        {{ c.name }}
                    </div>
                    <div ng-hide="isSplitScreen()" class="col-md-2 center">
                        <span ng-show="c.startTime">{{ c.startTime | elapsed }}</span>
                        <span ng-hide="c.startTime">&#8212;</span>
                    </div>
                    <div ng-hide="isSplitScreen()" class="col-md-2 center">
                        <span ng-show="c.expirationTime">{{ c.expirationTime | date:'MM-dd-yyyy' }}</span>
                        <span ng-hide="c.expirationTime">&#8212;</span>
                    </div>
                    <div ng-hide="isSplitScreen()" class="col-md-2 center">
                        <span ng-class="c.status === 'ACTIVE' ? '' : 'null'">{{ c.participants.length || 0 }}</span>
                    </div>
                    <div ng-hide="isSplitScreen()" class="col-md-2">
                        <span class="pull-right">
                            <i ng-class="c.invitationOnly ? '' : 'null'" class="fa fa-lock" title="{{ c.invitationOnly ? 'private' : 'public' }} game"></i>
                            <i ng-class="c.friendsOnly ? '' : 'null'" class="fa fa-users" title="{{ c.friendsOnly ? 'friends-only' : 'everyone is' }} allowed"></i>
                            <i ng-class="c.levelCap ? '' : 'null'" class="fa fa-user-times" title="{{ c.levelCap ? 'Level ' + c.levelCap + 'and under' : 'No level cap' }}"></i>
                            <i ng-class="c.perksAllowed ? '' : 'null'" class="fa fa-gift" title="perks are {{ c.perksAllowed ? '' : 'NOT' }} allowed"></i>
                            <i ng-class="c.robotsAllowed ? '' : 'null'" class="fa fa-android" title="robots are {{ c.robotsAllowed ? '' : 'NOT' }} allowed"></i>
                        </span>
                    </div>
                </div>

            </div>
        </fieldset>
    </div>

    <!-- Game Lobby -->
    <div ng-show="isSplitScreen()" class="col-md-8">
        <fieldset class="contest" ng-show="selectedContest.participants">
            <legend class="contest">
                <span class="game_title clickable" ng-click="toggleSplitScreen()">
                    <i class="fa fa-chevron-circle-left st_control" title="Return to results"></i>
                    {{selectedContest.name}}
                </span>
            </legend>
            <div class="row contest_lobby contest_colors">
                <div class="col-md-12" style="background: #e0e0e0; border-radius: 6px; padding: 4px">
                    <div style="margin-left: auto; margin-right: auto" ng-repeat="row in [0,1,2]">
                        <span ng-repeat="p in getAvailableSlots(selectedContest, row) track by $index">
                            <avatar ng-show="p" id="{{ p.facebookID }}" style="width: 53px; height: 53px; margin: 2px 0px 2px 0px" />
                            <img class="no_picture_gang clickable"
                                ng-hide="p"
                                ng-click="invitePlayerPopup(findPlayerByID(selectedContest, MySession.getUserID()))"
                                title="invite a friend"
                                src="/assets/images/play/unknown-53.jpg">
                        </span>
                    </div>
                </div>

                <div ng-hide="selectedContest.leader" class="col-md-12">&nbsp;</div>
                <div ng-show="selectedContest.leader" class="col-md-3">Leader</div>
                <div ng-show="selectedContest.leader" class="col-md-9">
                    <img ng-if="selectedContest.status === 'CLOSED'" ng-src="/assets/images/{{ trophy(selectedContest.leader.rank) }}">
                    <avatar id="{{ selectedContest.leader.facebookID }}" style="width: 20px; height: 20px" />
                    <span ng-class="'rank_' + selectedContest.leader.rank">{{ selectedContest.leader.rank }}</span>
                    <span ng-class="selectedContest.leader.gainLoss >= 0 ? 'positive' : 'negative'">
                        <changearrow value="{{ selectedContest.leader.gainLoss }}" /> {{ selectedContest.leader.gainLoss | number:2 }}%
                    </span>
                </div>

                <div class="col-md-3">Status</div>
                <div class="col-md-5">
                    <span ng-class="getStatusClass(selectedContest, parseInt('@maxPlayers'))">{{ selectedContest.status }}</span>
                </div>
                <div class="col-md-4">
                    <input id="friendsOnly" type="checkbox" ng-model="selectedContest.friendsOnly" disabled>
                    <i class="fa fa-users"></i> <label for="friendsOnly">Friends-Only</label>
                </div>

                <div class="col-md-3">Created</div>
                <div class="col-md-5">{{ selectedContest.creationTime | date:'MM/dd/yyyy hh:mma' }}</div>
                <div class="col-md-4">
                    <input id="perksAllowed" type="checkbox" ng-model="selectedContest.perksAllowed" disabled>
                    <i class="fa fa-gift"></i> <label for="perksAllowed">Perks Allowed</label>
                </div>

                <div class="col-md-3">Started</div>
                <div class="col-md-5">
                    <span ng-show="selectedContest.startTime">{{ selectedContest.startTime | date:'MM/dd/yyyy hh:mma' }}</span>
                    <span ng-hide="selectedContest.startTime" class="null">Not Started</span>
                </div>
                <div class="col-md-4">
                    <input id="invitationOnly" type="checkbox" ng-model="selectedContest.invitationOnly" disabled>
                    <i class="fa fa-lock"></i> <label for="invitationOnly">Invitation-Only</label>
                </div>

                <div class="col-md-3">Ends</div>
                <div class="col-md-5">
                    <span ng-show="selectedContest.expirationTime">{{ selectedContest.expirationTime | date:'MM/dd/yyyy hh:mma' }}</span>
                    <span ng-hide="selectedContest.expirationTime" class="null">Not Specified</span>
                </div>
                <div class="col-md-4">
                    <input id="robotsAllowed" type="checkbox" ng-model="selectedContest.robotsAllowed" disabled>
                    <i class="fa fa-android"></i> <label for="robotsAllowed">Robots Allowed</label>
                </div>

                <div class="col-md-3">Buy-In Cost</div>
                <div class="col-md-9">
                    <span ng-class="MySession.getNetWorth() >= selectedContest.startingBalance ? 'positive' : 'negative'">
                        $ {{ selectedContest.startingBalance | number }}
                    </span>
                </div>

                <div class="col-md-3">Level Cap</div>
                <div class="col-md-9">
                    {{ selectedContest.levelCap }} &#8212; {{ levels[selectedContest.levelCap].description }}
                </div>
            </div>
            <div class="row" style="margin-top: 5px">
                <div class="col-md-2">
                    <button class="btn btn-default st_button"
                        ng-disabled="!isParticipant(selectedContest)"
                        ng-click="enterGame(selectedContest)">
                        <i class="fa fa-arrow-circle-right"></i> Enter
                    </button>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-default st_button"
                        ng-show="isContestOwner(selectedContest) && !selectedContest.startTime"
                        ng-click="startContest(selectedContest)">
                        <i ng-hide="selectedContest.starting" class="fa fa-youtube-play"></i>
                        <img ng-show="selectedContest.starting" src="/assets/images/status/loading.gif"> Start
                    </button>
                    <button class="btn btn-default st_button"
                        ng-disabled="!MySession.authenticated"
                        ng-show="isJoinable(selectedContest)"
                        ng-click="joinContest(selectedContest)">
                        <i ng-hide="selectedContest.joining" class="fa fa-user"></i>
                        <img ng-show="selectedContest.joining" src="/assets/images/status/loading.gif"> Join
                    </button>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-default st_button"
                        ng-show="isDeletable(selectedContest)"
                        ng-click="deleteContest(selectedContest)">
                        <i ng-hide="selectedContest.deleting" class="fa fa-warning"></i>
                        <img ng-show="selectedContest.deleting" src="/assets/images/status/loading.gif"> Delete
                    </button>
                    <button class="btn btn-default st_button"
                        ng-show="!isContestOwner(selectedContest) && isParticipant(selectedContest)"
                        ng-click="quitContest(selectedContest)">
                        <i ng-hide="selectedContest.quitting" class="fa fa-warning"></i>
                        <img ng-show="selectedContest.quitting" src="/assets/images/status/loading.gif"> Quit
                    </button>
                </div>
                <div class="col-md-6">&nbsp;</div>
            </div>
        </fieldset>
    </div>
</div>
